<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watermark Removal Tool</title>
    <style>
        /* Styling */
        body { font-family: Arial, sans-serif; text-align: center; }
        canvas { border: 1px solid #ccc; margin-top: 20px; }
        input[type="file"] { margin: 20px; padding: 10px; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Watermark Removal Tool</h1>
    <input type="file" id="file-input" accept="image/*" />
    <button onclick="removeWatermark()">Remove Watermark</button>
    <canvas id="output-canvas"></canvas>

    <!-- Load TensorFlow.js and BodyPix model -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix"></script>

    <script>
        let net;

        async function loadModel() {
            net = await bodyPix.load();
            console.log("Model Loaded!");
        }

        // Load the model when the page is ready
        loadModel();

        async function removeWatermark() {
            const fileInput = document.getElementById('file-input');
            const canvas = document.getElementById('output-canvas');
            const context = canvas.getContext('2d');

            if (fileInput.files.length === 0) {
                alert("Please select an image.");
                return;
            }

            const file = fileInput.files[0];
            const image = new Image();
            const reader = new FileReader();

            reader.onload = function (event) {
                image.src = event.target.result;
            };

            image.onload = async function () {
                // Resize the canvas to match the image size
                canvas.width = image.width;
                canvas.height = image.height;
                context.drawImage(image, 0, 0, image.width, image.height);

                // Segment the image to find the watermark area (use BodyPix or other segmentation model)
                const segmentation = await net.segmentPerson(image);

                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;

                // Loop through each pixel, and if it's part of the watermark, set it to transparent
                for (let i = 0; i < data.length; i += 4) {
                    const index = i / 4;
                    if (segmentation.data[index] === 0) {  // Background or watermark
                        data[i + 3] = 0;  // Set alpha to 0 (transparent)
                    }
                }

                // Put the edited image data back onto the canvas
                context.putImageData(imageData, 0, 0);

                // Display the modified image
                const link = document.createElement('a');
                link.href = canvas.toDataURL();
                link.download = 'output.png';
                link.click();
            };

            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
