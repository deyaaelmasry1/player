<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text Removal from Image</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/2.1.2/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.2.0/pixi.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.5.1/fabric.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    #canvas-container {
      margin-top: 20px;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    #image-input {
      margin-bottom: 20px;
    }
    .controls {
      margin-top: 10px;
    }
    .controls button {
      margin-right: 10px;
    }
  </style>
</head>
<body>

<h1>Remove Text from Image</h1>
<p>Upload an image, detect any text, and remove it from the image using a blur or masking effect.</p>

<input type="file" id="image-input" accept="image/*">
<div id="image-info"></div>

<!-- Canvas for PixiJS Image -->
<div id="canvas-container">
  <canvas id="pixi-canvas" width="800" height="600"></canvas>
</div>

<div class="controls">
  <button id="remove-text">Remove Text</button>
</div>

<script>
  let imageElement, appPixi;
  let detectedTextRegions = [];

  document.getElementById('image-input').addEventListener('change', handleImageUpload);

  function handleImageUpload(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        // Create image element
        const img = new Image();
        img.onload = function() {
          imageElement = img;
          document.getElementById('image-info').innerHTML = 'Image loaded. Ready to detect text.';

          // Initialize PixiJS canvas
          appPixi = new PIXI.Application({
            view: document.getElementById('pixi-canvas'),
            width: 800,
            height: 600
          });

          const texture = PIXI.Texture.from(img);
          const sprite = new PIXI.Sprite(texture);
          appPixi.stage.addChild(sprite);

          detectTextAndRemove(img);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  // Detect text in the image using Tesseract.js
  function detectTextAndRemove(img) {
    Tesseract.recognize(
      img,
      'eng',
      {
        logger: (m) => console.log(m)
      }
    ).then(({ data: { text, blocks } }) => {
      console.log("Detected Text: ", text);
      if (blocks) {
        // Loop through each block and store the region where text is found
        detectedTextRegions = blocks.map(block => block.bbox);
        alert("Text detected, now you can remove it.");
      } else {
        alert("No text detected.");
      }
    });
  }

  // Remove detected text areas from the image by applying a blur or mask
  document.getElementById('remove-text').addEventListener('click', () => {
    if (appPixi && imageElement && detectedTextRegions.length > 0) {
      const texture = PIXI.Texture.from(imageElement);
      const sprite = new PIXI.Sprite(texture);
      appPixi.stage.addChild(sprite);

      // For each detected text region, apply a blur or masking effect
      detectedTextRegions.forEach(region => {
        const rect = new PIXI.Graphics();
        rect.beginFill(0xFFFFFF, 1); // White fill to mask the text
        rect.drawRect(region.x, region.y, region.width, region.height);
        rect.endFill();

        // Add the rectangle over the detected text area
        appPixi.stage.addChild(rect);

        // Optionally, you could apply a blur to the text region:
        // rect.filters = [new PIXI.filters.BlurFilter(5)]; // Adjust blur amount as needed
      });

      appPixi.render();
    } else {
      alert("No text detected to remove.");
    }
  });
</script>

</body>
</html>
