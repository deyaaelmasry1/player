<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech (MP3 Download)</title>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_KEY"></script> <!-- Free API -->
</head>
<body>
    <h1>Text to Speech (Generate & Download MP3)</h1>

    <textarea id="text-to-speech" rows="4" cols="50" placeholder="Enter text here..."></textarea><br><br>
    <button onclick="convertTextToSpeech()">Convert to Speech</button>
    <button id="download-btn" onclick="downloadSpeech()" disabled>Download MP3</button>

    <audio id="audio-player" controls></audio> <!-- Play generated audio -->

    <script>
        let audioUrl = null;

        async function convertTextToSpeech() {
            const text = document.getElementById("text-to-speech").value.trim();
            if (text === "") {
                alert("Please enter some text.");
                return;
            }

            // Use ResponsiveVoice API to generate an MP3 URL
            responsiveVoice.speak(text, "UK English Male", {
                onstart: function() {
                    document.getElementById("download-btn").disabled = true;
                },
                onend: async function() {
                    try {
                        // Fetch the generated MP3 file (ResponsiveVoice provides MP3 links for some voices)
                        const response = await fetch(`https://api.responsivevoice.org/v1/text:synthesize?text=${encodeURIComponent(text)}&lang=en-gb&engine=g1`);
                        const blob = await response.blob();
                        audioUrl = URL.createObjectURL(blob);

                        // Play the audio and enable download
                        document.getElementById("audio-player").src = audioUrl;
                        document.getElementById("download-btn").disabled = false;
                    } catch (error) {
                        console.error("MP3 generation failed:", error);
                        alert("Failed to generate MP3. Please try again.");
                    }
                }
            });
        }

        function downloadSpeech() {
            if (audioUrl) {
                const link = document.createElement('a');
                link.href = audioUrl;
                link.download = 'speech.mp3'; 
                link.click();
            } else {
                alert("No MP3 file available. Try again.");
            }
        }
    </script>
</body>
</html>
